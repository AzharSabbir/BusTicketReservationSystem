<div class="container">
    <header>
        <h2>Bus Ticket Reservation System</h2>
    </header>

    <form class="search-form" #searchForm="ngForm" (ngSubmit)="onSearchSubmit(searchForm)">
        <div class="form-group">
            <label for="from">GOING FROM</label>
            <select id="from" name="from" [(ngModel)]="searchModel.from" required>
                <option value="" disabled>Select origin</option>
                <option *ngFor="let loc of fromLocations" [value]="loc">
                    {{ loc }}
                </option>
            </select>
        </div>
        <div class="form-group">
            <label for="to">GOING TO</label>
            <select id="to" name="to" [(ngModel)]="searchModel.to" required>
                <option value="" disabled>Select destination</option>
                <option *ngFor="let loc of toLocations" [value]="loc">
                    {{ loc }}
                </option>
            </select>
        </div>
        <div class="form-group">
            <label for="journeyDate">JOURNEY DATE</label>
            <input type="date" id="journeyDate" name="journeyDate" [(ngModel)]="searchModel.journeyDate" required>
        </div>
        <div class="form-group">
            <button type="submit" class="btn-search" [disabled]="searchForm.invalid || isLoading">
                {{ isLoading ? 'Searching...' : 'Search Bus' }}
            </button>
        </div>
    </form>

    <div class="results-container">

        <div *ngIf="isLoading" class="loading-spinner">
            Loading results...
        </div>

        <div *ngIf="searchError" class="error-message">
            {{ searchError }}
        </div>

        <div *ngIf="hasSearched && !isLoading && searchResults.length === 0 && !searchError" class="no-results">
            No buses found for this route.
        </div>

        <div *ngIf="!isLoading && searchResults.length > 0" class="results-list">

            <div class="results-header">
                <div class="route-info">
                    <h3>ONWARD</h3>
                    <p>{{ searchModel.from }} To {{ searchModel.to }} On {{ searchModel.journeyDate | date: 'dd MMM
                        yyyy' }}</p>
                </div>
                <span style="color: white;">Total Buses Found: {{ totalBusesFound }}</span>
            </div>

            <div class="results-controls">
                <div class="sort-options">
                    <strong>SORT BY:</strong>
                    <span class="sort-option-dt" (click)="sortResults('DEPARTURE TIME')"
                        [class.active-sort]="currentSortCriteria === 'DEPARTURE TIME'">
                        DEPARTURE TIME <span
                            [innerHTML]="currentSortCriteria === 'DEPARTURE TIME' ? (sortAscending ? '&#9650;' : '&#9660;') : '&#9679;'"></span>
                    </span>
                    <span class="sort-option-as" (click)="sortResults('AVAILABLE SEATS')"
                        [class.active-sort]="currentSortCriteria === 'AVAILABLE SEATS'">
                        AVAILABLE SEATS <span
                            [innerHTML]="currentSortCriteria === 'AVAILABLE SEATS' ? (sortAscending ? '&#9650;' : '&#9660;') : '&#9679;'"></span>
                    </span>
                    <span class="sort-option-f" (click)="sortResults('FARE')"
                        [class.active-sort]="currentSortCriteria === 'FARE'">
                        FARE <span
                            [innerHTML]="currentSortCriteria === 'FARE' ? (sortAscending ? '&#9650;' : '&#9660;') : '&#9679;'"></span>
                    </span>
                </div>
            </div>

            <div *ngFor="let bus of searchResults" class="bus-card">

                <div class="card-bus-info">
                    <h4>{{ bus.companyName }}</h4>
                    <p>{{ bus.busName }}</p>
                </div>

                <div class="card-time-location">
                    <small>Starting</small>
                    <p><strong>{{ bus.startTime | date: 'shortTime' }}</strong></p>
                    <small>{{ bus.departureLocation }}</small>
                </div>

                <div class="card-seats">
                    <small>Seats Left: {{ bus.seatsLeft }}</small>
                </div>

                <div class="card-time-location">
                    <small>Arrival</small>
                    <p><strong>{{ bus.arrivalTime | date: 'shortTime' }}</strong></p>
                    <small>{{ bus.arrivalLocation }}</small>
                </div>

                <div class="card-fare">
                    <p><strong>{{ bus.price | currency: 'à§³' }}</strong></p>
                </div>

                <div class="card-action">
                    <a class="btn-view-seats" [routerLink]="['/seat-plan', bus.busScheduleId]">
                        VIEW SEATS
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>