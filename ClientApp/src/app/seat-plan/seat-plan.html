<div class="container">

    <button (click)="goBack()" class="btn-back">&larr; Modify Search</button>

    <div *ngIf="isLoading" class="loading-spinner">Loading seat plan...</div>
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

    <div *ngIf="seatPlan && !isLoading">
        <header>
            <h2>Select Your Seats</h2>
            <h3>{{ seatPlan.busName }}</h3>
        </header>

        <div class="seat-plan-container">

            <div class="seat-grid-wrapper">
                <div class="seat-legend">
                    <div><span class="seat-icon available"></span> Available</div>
                    <div><span class="seat-icon selected"></span> Selected</div>
                    <div><span class="seat-icon booked"></span> Booked / Sold</div>
                </div>

                <div class="seat-grid">
                    <div *ngFor="let seat of seatPlan.seats; let i = index; trackBy: trackBySeatId" class="seat"
                        [ngClass]="{
          'available': seat.status === 'Available',
          'booked': seat.status === 'Booked' || seat.status === 'Sold',
          'selected': seat.seatId === selectedSeat?.seatId
        }" (click)="selectSeat(seat)">
                        {{ seat.seatNumber }}
                    </div>
                </div>
                <p class="instruction-text">Click on an available seat to select</p>
            </div>

            <div class="booking-form-wrapper">

                <div class="boarding-dropping-section">
                    <h4>BOARDING/DROPPING:</h4>
                    <div class="form-group">
                        <label for="boarding">BOARDING POINT*</label>
                        <select id="boarding" name="boarding" [(ngModel)]="boardingPoint" required>
                            <option [ngValue]="null" disabled>Select boarding point</option>
                            <option *ngFor="let stop of seatPlan?.boardingPoints" [value]="stop.id">
                                {{stop.name}}
                            </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dropping">DROPPING POINT*</label>
                        <select id="dropping" name="dropping" [(ngModel)]="droppingPoint" required>
                            <option [ngValue]="null" disabled>Select dropping point</option>
                            <option *ngFor="let stop of seatPlan?.droppingPoints" [value]="stop.id">
                                {{stop.name}}
                            </option>
                        </select>
                    </div>
                </div>

                <div class="fare-details" *ngIf="selectedSeat && seatPlan">
                    <p>Seat Fare:
                        <span>{{ seatPlan.seatFare | currency:'৳' }}</span>
                    </p>
                    <p>Service Charge:
                        <span>{{ seatPlan.serviceCharge | currency:'৳' }}</span>
                    </p>
                    <p>PGW Charge:
                        <span>{{ seatPlan.pgwCharge | currency:'৳' }}</span>
                    </p>
                    <p class="total-discount">Total Discount:
                        <span>{{ seatPlan.discount | currency:'৳' }}</span>
                    </p>
                    <hr>
                    <p><strong>Total Payable:</strong>
                        <span>{{ (seatPlan.seatFare + seatPlan.serviceCharge + seatPlan.pgwCharge - seatPlan.discount) |
                            currency:'৳' }}</span>
                    </p>
                </div>

                <div class="passenger-details-section">
                    <div class="form-group">
                        <label for="mobile">MOBILE NUMBER*</label>
                        <input type="text" id="mobile" name="mobile" placeholder="Enter your mobile number"
                            [(ngModel)]="passengerMobile" required>
                    </div>

                    <form *ngIf="selectedSeat" #bookingForm="ngForm" (ngSubmit)="onBookingSubmit(bookingForm)"
                        class="booking-subform">
                        <div class="form-group">
                            <label>Selected Seat: {{selectedSeat.seatNumber}}</label>
                        </div>
                        <div class="form-group">
                            <label for="name">PASSENGER NAME*</label>
                            <input type="text" id="name" name="name" placeholder="Enter passenger name"
                                [(ngModel)]="passengerName" required>
                        </div>

                        <button type="submit" class="btn-confirm"
                            [disabled]="bookingForm.invalid || isBooking || !boardingPoint || !droppingPoint">
                            {{ isBooking ? 'Processing...' : 'SUBMIT' }}
                        </button>
                    </form>

                    <div *ngIf="!selectedSeat" class="no-seat-selected">
                        Please select an available seat.
                    </div>
                </div>

                <div class="terms-login-section">
                    <p>I have already verified my phone number, and have a password. Login with password. <a
                            href="#">Click here</a></p>
                    <p>By logging in you are agreeing to the <a href="#">Terms & Conditions</a> and <a href="#">Privacy
                            Notice</a> of bdtickets</p>
                </div>

                <div *ngIf="bookingResult" class="booking-result"
                    [ngClass]="bookingResult.success ? 'success' : 'error'">
                    {{ bookingResult.message }}
                </div>

            </div>
        </div>
    </div>
</div>